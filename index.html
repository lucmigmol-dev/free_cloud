<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Cloud - lucmigmol-dev</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, sans-serif; }
        .file { cursor: pointer; }
        .file:hover { background-color: #f3f4f6; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-6">
        <h1 class="text-4xl font-bold text-center mb-8 text-indigo-700">‚òÅÔ∏è Mon Cloud Personnel</h1>
        <div id="upload" class="mb-6 p-4 bg-white rounded shadow">
            <input type="file" id="fileInput" multiple class="mb-2">
            <button onclick="uploadFiles()" class="bg-indigo-600 text-white px-4 py-2 rounded">Uploader</button>
        </div>
        <div id="files" class="bg-white rounded shadow p-6"></div>
    </div>

    <script>
        const repo = 'lucmigmol-dev/free_cloud';
        const branch = 'main';
        const basePath = 'data/';  // Tout pointe sur /data maintenant
        const token = prompt('Entre ton Personal Access Token GitHub (ghp_...) pour upload/sync'); // √Ä entrer une fois

        async function listFiles(path = '') {
            const fullPath = basePath + path;
            const url = `https://api.github.com/repos/${repo}/contents/${fullPath}?ref=${branch}`;
            const res = await fetch(url, {headers: {Authorization: `token ${token}`}});
            const data = await res.json();
            const container = document.getElementById('files');
            container.innerHTML = `<h2 class="text-2xl mb-4">Dossier: /${path}</h2><ul class="space-y-2">`;
            data.forEach(item => {
                const li = document.createElement('li');
                li.className = 'file p-3 rounded';
                if (item.type === 'dir') {
                    li.innerHTML = `üìÅ <strong>${item.name}</strong>`;
                    li.onclick = () => listFiles(item.path.replace(basePath, ''));
                } else {
                    li.innerHTML = `üìÑ ${item.name} (${item.size} bytes)`;
                    li.onclick = () => window.open(item.download_url);
                }
                container.querySelector('ul').appendChild(li);
            });
            container.innerHTML += '</ul>';
        }

        async function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = async () => {
                    const content = reader.result.split(',')[1];
                    await fetch(`https://api.github.com/repos/${repo}/contents/${basePath}${file.name}`, {
                        method: 'PUT',
                        headers: {Authorization: `token ${token}`, 'Content-Type': 'application/json'},
                        body: JSON.stringify({message: 'Upload via web dans data', content, branch})
                    });
                };
                reader.readAsDataURL(file);
            }
            alert('Upload termin√© !');
            listFiles();
        }

        listFiles();
        setInterval(listFiles, 10000); // Refresh toutes les 10 sec
    </script>
</body>
</html>