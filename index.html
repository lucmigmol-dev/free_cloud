<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Cloud - lucmigmol-dev</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, sans-serif; background: linear-gradient(to bottom, #f3f4f6, #ffffff); }
        .file { transition: all 0.2s; }
        .file:hover { transform: scale(1.02); background-color: #e5e7eb; }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto p-6 max-w-4xl">
        <h1 class="text-5xl font-bold text-center mb-10 text-indigo-800 drop-shadow-md">‚òÅÔ∏è Mon Cloud Personnel</h1>
        <div id="upload" class="mb-8 p-6 bg-white rounded-xl shadow-lg">
            <input type="file" id="fileInput" multiple class="mb-4 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none">
            <button onclick="uploadFiles()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-indigo-700 transition">Uploader des fichiers</button>
        </div>
        <div id="files" class="bg-white rounded-xl shadow-lg p-6"></div>
    </div>

    <script>
        const repo = 'lucmigmol-dev/free_cloud';
        const branch = 'main';
        const basePath = 'data/';  // Seulement data !
        let token = localStorage.getItem('githubToken');
        if (!token) {
            token = prompt('Entre ton PAT GitHub (ghp_...) pour sync/upload (stock√© localement)');
            localStorage.setItem('githubToken', token);
        }

        async function listFiles(path = '') {
            const fullPath = basePath + path;
            const url = `https://api.github.com/repos/${repo}/contents/${fullPath}?ref=${branch}`;
            const res = await fetch(url, {headers: {Authorization: `token ${token}`}});
            if (!res.ok) return alert('Erreur API : v√©rifie ton token ou connexion');
            const data = await res.json();
            const container = document.getElementById('files');
            container.innerHTML = `<h2 class="text-3xl font-semibold mb-6 text-gray-800">üìÇ Dossier : ${path || 'Racine'}</h2><ul class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
            data.forEach(item => {
                const li = document.createElement('li');
                li.className = 'file p-4 rounded-lg bg-gray-50 border border-gray-200 hover:shadow-md';
                if (item.type === 'dir') {
                    li.innerHTML = `üìÅ <strong>${item.name}</strong>`;
                    li.onclick = () => listFiles(`${path}${item.name}/`);
                } else {
                    li.innerHTML = `üìÑ ${item.name} <span class="text-sm text-gray-500">(${ (item.size / 1024).toFixed(1) } KB)</span>`;
                    li.onclick = () => window.open(item.download_url, '_blank');
                }
                container.querySelector('ul').appendChild(li);
            });
            container.innerHTML += '</ul>';
        }

        async function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = async () => {
                    const content = btoa(reader.result);  // Base64 pour tout type de fichier
                    await fetch(`https://api.github.com/repos/${repo}/contents/${basePath}${file.name}`, {
                        method: 'PUT',
                        headers: {Authorization: `token ${token}`, 'Content-Type': 'application/json'},
                        body: JSON.stringify({message: 'Upload via cloud web', content, branch})
                    });
                };
                reader.readAsBinaryString(file);
            }
            alert('Upload en cours... Rafra√Æchis dans 5 sec !');
            setTimeout(listFiles, 6000);
        }

        listFiles();
        setInterval(listFiles, 5000);  // Sync toutes les 5 sec !
    </script>
</body>
</html>